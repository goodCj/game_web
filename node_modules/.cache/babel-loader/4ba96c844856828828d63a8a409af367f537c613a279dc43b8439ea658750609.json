{"ast":null,"code":"import _toConsumableArray from \"/Users/liusu/Desktop/h5_free/game/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport { __rest } from \"tslib\";\nimport useCreation from '../../useCreation';\nimport useLatest from '../../useLatest';\nimport useMemoizedFn from '../../useMemoizedFn';\nimport useMount from '../../useMount';\nimport useUnmount from '../../useUnmount';\nimport useUpdate from '../../useUpdate';\nimport Fetch from './Fetch';\nfunction useRequestImplement(service) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var plugins = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n  var _options$manual = options.manual,\n    manual = _options$manual === void 0 ? false : _options$manual,\n    rest = __rest(options, [\"manual\"]);\n  var fetchOptions = Object.assign({\n    manual: manual\n  }, rest);\n  var serviceRef = useLatest(service);\n  var update = useUpdate();\n  var fetchInstance = useCreation(function () {\n    var initState = plugins.map(function (p) {\n      var _a;\n      return (_a = p === null || p === void 0 ? void 0 : p.onInit) === null || _a === void 0 ? void 0 : _a.call(p, fetchOptions);\n    }).filter(Boolean);\n    return new Fetch(serviceRef, fetchOptions, update, Object.assign.apply(Object, [{}].concat(_toConsumableArray(initState))));\n  }, []);\n  fetchInstance.options = fetchOptions;\n  // run all plugins hooks\n  fetchInstance.pluginImpls = plugins.map(function (p) {\n    return p(fetchInstance, fetchOptions);\n  });\n  useMount(function () {\n    if (!manual) {\n      // useCachePlugin can set fetchInstance.state.params from cache when init\n      var params = fetchInstance.state.params || options.defaultParams || [];\n      // @ts-ignore\n      fetchInstance.run.apply(fetchInstance, _toConsumableArray(params));\n    }\n  });\n  useUnmount(function () {\n    fetchInstance.cancel();\n  });\n  return {\n    loading: fetchInstance.state.loading,\n    data: fetchInstance.state.data,\n    error: fetchInstance.state.error,\n    params: fetchInstance.state.params || [],\n    cancel: useMemoizedFn(fetchInstance.cancel.bind(fetchInstance)),\n    refresh: useMemoizedFn(fetchInstance.refresh.bind(fetchInstance)),\n    refreshAsync: useMemoizedFn(fetchInstance.refreshAsync.bind(fetchInstance)),\n    run: useMemoizedFn(fetchInstance.run.bind(fetchInstance)),\n    runAsync: useMemoizedFn(fetchInstance.runAsync.bind(fetchInstance)),\n    mutate: useMemoizedFn(fetchInstance.mutate.bind(fetchInstance))\n  };\n}\nexport default useRequestImplement;","map":{"version":3,"names":["__rest","useCreation","useLatest","useMemoizedFn","useMount","useUnmount","useUpdate","Fetch","useRequestImplement","service","options","arguments","length","undefined","plugins","_options$manual","manual","rest","fetchOptions","Object","assign","serviceRef","update","fetchInstance","initState","map","p","_a","onInit","call","filter","Boolean","apply","concat","_toConsumableArray","pluginImpls","params","state","defaultParams","run","cancel","loading","data","error","bind","refresh","refreshAsync","runAsync","mutate"],"sources":["/Users/liusu/Desktop/h5_free/game/node_modules/ahooks/es/useRequest/src/useRequestImplement.js"],"sourcesContent":["import { __rest } from \"tslib\";\nimport useCreation from '../../useCreation';\nimport useLatest from '../../useLatest';\nimport useMemoizedFn from '../../useMemoizedFn';\nimport useMount from '../../useMount';\nimport useUnmount from '../../useUnmount';\nimport useUpdate from '../../useUpdate';\nimport Fetch from './Fetch';\nfunction useRequestImplement(service, options = {}, plugins = []) {\n  const {\n      manual = false\n    } = options,\n    rest = __rest(options, [\"manual\"]);\n  const fetchOptions = Object.assign({\n    manual\n  }, rest);\n  const serviceRef = useLatest(service);\n  const update = useUpdate();\n  const fetchInstance = useCreation(() => {\n    const initState = plugins.map(p => {\n      var _a;\n      return (_a = p === null || p === void 0 ? void 0 : p.onInit) === null || _a === void 0 ? void 0 : _a.call(p, fetchOptions);\n    }).filter(Boolean);\n    return new Fetch(serviceRef, fetchOptions, update, Object.assign({}, ...initState));\n  }, []);\n  fetchInstance.options = fetchOptions;\n  // run all plugins hooks\n  fetchInstance.pluginImpls = plugins.map(p => p(fetchInstance, fetchOptions));\n  useMount(() => {\n    if (!manual) {\n      // useCachePlugin can set fetchInstance.state.params from cache when init\n      const params = fetchInstance.state.params || options.defaultParams || [];\n      // @ts-ignore\n      fetchInstance.run(...params);\n    }\n  });\n  useUnmount(() => {\n    fetchInstance.cancel();\n  });\n  return {\n    loading: fetchInstance.state.loading,\n    data: fetchInstance.state.data,\n    error: fetchInstance.state.error,\n    params: fetchInstance.state.params || [],\n    cancel: useMemoizedFn(fetchInstance.cancel.bind(fetchInstance)),\n    refresh: useMemoizedFn(fetchInstance.refresh.bind(fetchInstance)),\n    refreshAsync: useMemoizedFn(fetchInstance.refreshAsync.bind(fetchInstance)),\n    run: useMemoizedFn(fetchInstance.run.bind(fetchInstance)),\n    runAsync: useMemoizedFn(fetchInstance.runAsync.bind(fetchInstance)),\n    mutate: useMemoizedFn(fetchInstance.mutate.bind(fetchInstance))\n  };\n}\nexport default useRequestImplement;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}