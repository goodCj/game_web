{"ast":null,"code":"import _regeneratorRuntime from \"/Users/liusu/Desktop/h5_free/game/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _toConsumableArray from \"/Users/liusu/Desktop/h5_free/game/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _slicedToArray from \"/Users/liusu/Desktop/h5_free/game/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { __awaiter } from \"tslib\";\nimport { useMemo, useState } from 'react';\nimport useEventListener from '../useEventListener';\nimport useMemoizedFn from '../useMemoizedFn';\nimport useRequest from '../useRequest';\nimport useUpdateEffect from '../useUpdateEffect';\nimport { getTargetElement } from '../utils/domTarget';\nimport { getClientHeight, getScrollHeight, getScrollTop } from '../utils/rect';\nvar useInfiniteScroll = function useInfiniteScroll(service) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var target = options.target,\n    isNoMore = options.isNoMore,\n    _options$threshold = options.threshold,\n    threshold = _options$threshold === void 0 ? 100 : _options$threshold,\n    _options$reloadDeps = options.reloadDeps,\n    reloadDeps = _options$reloadDeps === void 0 ? [] : _options$reloadDeps,\n    manual = options.manual,\n    _onBefore = options.onBefore,\n    _onSuccess = options.onSuccess,\n    _onError = options.onError,\n    _onFinally = options.onFinally;\n  var _useState = useState(),\n    _useState2 = _slicedToArray(_useState, 2),\n    finalData = _useState2[0],\n    setFinalData = _useState2[1];\n  var _useState3 = useState(false),\n    _useState4 = _slicedToArray(_useState3, 2),\n    loadingMore = _useState4[0],\n    setLoadingMore = _useState4[1];\n  var noMore = useMemo(function () {\n    if (!isNoMore) return false;\n    return isNoMore(finalData);\n  }, [finalData]);\n  var _useRequest = useRequest(function (lastData) {\n      return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var currentData;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return service(lastData);\n            case 2:\n              currentData = _context.sent;\n              if (!lastData) {\n                setFinalData(currentData);\n              } else {\n                setFinalData(Object.assign(Object.assign({}, currentData), {\n                  // @ts-ignore\n                  list: [].concat(_toConsumableArray(lastData.list), _toConsumableArray(currentData.list))\n                }));\n              }\n              return _context.abrupt(\"return\", currentData);\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n    }, {\n      manual: manual,\n      onFinally: function onFinally(_, d, e) {\n        setLoadingMore(false);\n        _onFinally === null || _onFinally === void 0 ? void 0 : _onFinally(d, e);\n      },\n      onBefore: function onBefore() {\n        return _onBefore === null || _onBefore === void 0 ? void 0 : _onBefore();\n      },\n      onSuccess: function onSuccess(d) {\n        setTimeout(function () {\n          // eslint-disable-next-line @typescript-eslint/no-use-before-define\n          scrollMethod();\n        });\n        _onSuccess === null || _onSuccess === void 0 ? void 0 : _onSuccess(d);\n      },\n      onError: function onError(e) {\n        return _onError === null || _onError === void 0 ? void 0 : _onError(e);\n      }\n    }),\n    loading = _useRequest.loading,\n    run = _useRequest.run,\n    runAsync = _useRequest.runAsync,\n    cancel = _useRequest.cancel;\n  var loadMore = function loadMore() {\n    if (noMore) return;\n    setLoadingMore(true);\n    run(finalData);\n  };\n  var loadMoreAsync = function loadMoreAsync() {\n    if (noMore) return Promise.reject();\n    setLoadingMore(true);\n    return runAsync(finalData);\n  };\n  var reload = function reload() {\n    return run();\n  };\n  var reloadAsync = function reloadAsync() {\n    return runAsync();\n  };\n  var scrollMethod = function scrollMethod() {\n    var el = getTargetElement(target);\n    if (!el) {\n      return;\n    }\n    var scrollTop = getScrollTop(el);\n    var scrollHeight = getScrollHeight(el);\n    var clientHeight = getClientHeight(el);\n    if (scrollHeight - scrollTop <= clientHeight + threshold) {\n      loadMore();\n    }\n  };\n  useEventListener('scroll', function () {\n    if (loading || loadingMore) {\n      return;\n    }\n    scrollMethod();\n  }, {\n    target: target\n  });\n  useUpdateEffect(function () {\n    run();\n  }, _toConsumableArray(reloadDeps));\n  return {\n    data: finalData,\n    loading: !loadingMore && loading,\n    loadingMore: loadingMore,\n    noMore: noMore,\n    loadMore: useMemoizedFn(loadMore),\n    loadMoreAsync: useMemoizedFn(loadMoreAsync),\n    reload: useMemoizedFn(reload),\n    reloadAsync: useMemoizedFn(reloadAsync),\n    mutate: setFinalData,\n    cancel: cancel\n  };\n};\nexport default useInfiniteScroll;","map":{"version":3,"names":["__awaiter","useMemo","useState","useEventListener","useMemoizedFn","useRequest","useUpdateEffect","getTargetElement","getClientHeight","getScrollHeight","getScrollTop","useInfiniteScroll","service","options","arguments","length","undefined","target","isNoMore","_options$threshold","threshold","_options$reloadDeps","reloadDeps","manual","onBefore","onSuccess","onError","onFinally","_useState","_useState2","_slicedToArray","finalData","setFinalData","_useState3","_useState4","loadingMore","setLoadingMore","noMore","_useRequest","lastData","_regeneratorRuntime","mark","_callee","currentData","wrap","_callee$","_context","prev","next","sent","Object","assign","list","concat","_toConsumableArray","abrupt","stop","_","d","e","setTimeout","scrollMethod","loading","run","runAsync","cancel","loadMore","loadMoreAsync","Promise","reject","reload","reloadAsync","el","scrollTop","scrollHeight","clientHeight","data","mutate"],"sources":["/Users/liusu/Desktop/h5_free/game/node_modules/ahooks/es/useInfiniteScroll/index.js"],"sourcesContent":["import { __awaiter } from \"tslib\";\nimport { useMemo, useState } from 'react';\nimport useEventListener from '../useEventListener';\nimport useMemoizedFn from '../useMemoizedFn';\nimport useRequest from '../useRequest';\nimport useUpdateEffect from '../useUpdateEffect';\nimport { getTargetElement } from '../utils/domTarget';\nimport { getClientHeight, getScrollHeight, getScrollTop } from '../utils/rect';\nconst useInfiniteScroll = (service, options = {}) => {\n  const {\n    target,\n    isNoMore,\n    threshold = 100,\n    reloadDeps = [],\n    manual,\n    onBefore,\n    onSuccess,\n    onError,\n    onFinally\n  } = options;\n  const [finalData, setFinalData] = useState();\n  const [loadingMore, setLoadingMore] = useState(false);\n  const noMore = useMemo(() => {\n    if (!isNoMore) return false;\n    return isNoMore(finalData);\n  }, [finalData]);\n  const {\n    loading,\n    run,\n    runAsync,\n    cancel\n  } = useRequest(lastData => __awaiter(void 0, void 0, void 0, function* () {\n    const currentData = yield service(lastData);\n    if (!lastData) {\n      setFinalData(currentData);\n    } else {\n      setFinalData(Object.assign(Object.assign({}, currentData), {\n        // @ts-ignore\n        list: [...lastData.list, ...currentData.list]\n      }));\n    }\n    return currentData;\n  }), {\n    manual,\n    onFinally: (_, d, e) => {\n      setLoadingMore(false);\n      onFinally === null || onFinally === void 0 ? void 0 : onFinally(d, e);\n    },\n    onBefore: () => onBefore === null || onBefore === void 0 ? void 0 : onBefore(),\n    onSuccess: d => {\n      setTimeout(() => {\n        // eslint-disable-next-line @typescript-eslint/no-use-before-define\n        scrollMethod();\n      });\n      onSuccess === null || onSuccess === void 0 ? void 0 : onSuccess(d);\n    },\n    onError: e => onError === null || onError === void 0 ? void 0 : onError(e)\n  });\n  const loadMore = () => {\n    if (noMore) return;\n    setLoadingMore(true);\n    run(finalData);\n  };\n  const loadMoreAsync = () => {\n    if (noMore) return Promise.reject();\n    setLoadingMore(true);\n    return runAsync(finalData);\n  };\n  const reload = () => run();\n  const reloadAsync = () => runAsync();\n  const scrollMethod = () => {\n    const el = getTargetElement(target);\n    if (!el) {\n      return;\n    }\n    const scrollTop = getScrollTop(el);\n    const scrollHeight = getScrollHeight(el);\n    const clientHeight = getClientHeight(el);\n    if (scrollHeight - scrollTop <= clientHeight + threshold) {\n      loadMore();\n    }\n  };\n  useEventListener('scroll', () => {\n    if (loading || loadingMore) {\n      return;\n    }\n    scrollMethod();\n  }, {\n    target\n  });\n  useUpdateEffect(() => {\n    run();\n  }, [...reloadDeps]);\n  return {\n    data: finalData,\n    loading: !loadingMore && loading,\n    loadingMore,\n    noMore,\n    loadMore: useMemoizedFn(loadMore),\n    loadMoreAsync: useMemoizedFn(loadMoreAsync),\n    reload: useMemoizedFn(reload),\n    reloadAsync: useMemoizedFn(reloadAsync),\n    mutate: setFinalData,\n    cancel\n  };\n};\nexport default useInfiniteScroll;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}