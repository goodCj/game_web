{"ast":null,"code":"import _slicedToArray from \"/Users/liusu/Desktop/h5_free/game/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { useEffect, useMemo, useState, useRef } from 'react';\nimport useEventListener from '../useEventListener';\nimport useLatest from '../useLatest';\nimport useMemoizedFn from '../useMemoizedFn';\nimport useSize from '../useSize';\nimport { getTargetElement } from '../utils/domTarget';\nimport { isNumber } from '../utils';\nvar useVirtualList = function useVirtualList(list, options) {\n  var containerTarget = options.containerTarget,\n    wrapperTarget = options.wrapperTarget,\n    itemHeight = options.itemHeight,\n    _options$overscan = options.overscan,\n    overscan = _options$overscan === void 0 ? 5 : _options$overscan;\n  var itemHeightRef = useLatest(itemHeight);\n  var size = useSize(containerTarget);\n  var scrollTriggerByScrollToFunc = useRef(false);\n  var _useState = useState([]),\n    _useState2 = _slicedToArray(_useState, 2),\n    targetList = _useState2[0],\n    setTargetList = _useState2[1];\n  var getVisibleCount = function getVisibleCount(containerHeight, fromIndex) {\n    if (isNumber(itemHeightRef.current)) {\n      return Math.ceil(containerHeight / itemHeightRef.current);\n    }\n    var sum = 0;\n    var endIndex = 0;\n    for (var i = fromIndex; i < list.length; i++) {\n      var height = itemHeightRef.current(i, list[i]);\n      sum += height;\n      endIndex = i;\n      if (sum >= containerHeight) {\n        break;\n      }\n    }\n    return endIndex - fromIndex;\n  };\n  var getOffset = function getOffset(scrollTop) {\n    if (isNumber(itemHeightRef.current)) {\n      return Math.floor(scrollTop / itemHeightRef.current) + 1;\n    }\n    var sum = 0;\n    var offset = 0;\n    for (var i = 0; i < list.length; i++) {\n      var height = itemHeightRef.current(i, list[i]);\n      sum += height;\n      if (sum >= scrollTop) {\n        offset = i;\n        break;\n      }\n    }\n    return offset + 1;\n  };\n  // 获取上部高度\n  var getDistanceTop = function getDistanceTop(index) {\n    if (isNumber(itemHeightRef.current)) {\n      var _height = index * itemHeightRef.current;\n      return _height;\n    }\n    var height = list.slice(0, index).reduce(function (sum, _, i) {\n      return sum + itemHeightRef.current(i, list[i]);\n    }, 0);\n    return height;\n  };\n  var totalHeight = useMemo(function () {\n    if (isNumber(itemHeightRef.current)) {\n      return list.length * itemHeightRef.current;\n    }\n    return list.reduce(function (sum, _, index) {\n      return sum + itemHeightRef.current(index, list[index]);\n    }, 0);\n  }, [list]);\n  var calculateRange = function calculateRange() {\n    var container = getTargetElement(containerTarget);\n    var wrapper = getTargetElement(wrapperTarget);\n    if (container && wrapper) {\n      var scrollTop = container.scrollTop,\n        clientHeight = container.clientHeight;\n      var offset = getOffset(scrollTop);\n      var visibleCount = getVisibleCount(clientHeight, offset);\n      var start = Math.max(0, offset - overscan);\n      var end = Math.min(list.length, offset + visibleCount + overscan);\n      var offsetTop = getDistanceTop(start);\n      wrapper.style.height = totalHeight - offsetTop + 'px';\n      wrapper.style.marginTop = offsetTop + 'px';\n      setTargetList(list.slice(start, end).map(function (ele, index) {\n        return {\n          data: ele,\n          index: index + start\n        };\n      }));\n    }\n  };\n  useEffect(function () {\n    if (!(size === null || size === void 0 ? void 0 : size.width) || !(size === null || size === void 0 ? void 0 : size.height)) {\n      return;\n    }\n    calculateRange();\n  }, [size === null || size === void 0 ? void 0 : size.width, size === null || size === void 0 ? void 0 : size.height, list]);\n  useEventListener('scroll', function (e) {\n    if (scrollTriggerByScrollToFunc.current) {\n      scrollTriggerByScrollToFunc.current = false;\n      return;\n    }\n    e.preventDefault();\n    calculateRange();\n  }, {\n    target: containerTarget\n  });\n  var scrollTo = function scrollTo(index) {\n    var container = getTargetElement(containerTarget);\n    if (container) {\n      scrollTriggerByScrollToFunc.current = true;\n      container.scrollTop = getDistanceTop(index);\n      calculateRange();\n    }\n  };\n  return [targetList, useMemoizedFn(scrollTo)];\n};\nexport default useVirtualList;","map":{"version":3,"names":["useEffect","useMemo","useState","useRef","useEventListener","useLatest","useMemoizedFn","useSize","getTargetElement","isNumber","useVirtualList","list","options","containerTarget","wrapperTarget","itemHeight","_options$overscan","overscan","itemHeightRef","size","scrollTriggerByScrollToFunc","_useState","_useState2","_slicedToArray","targetList","setTargetList","getVisibleCount","containerHeight","fromIndex","current","Math","ceil","sum","endIndex","i","length","height","getOffset","scrollTop","floor","offset","getDistanceTop","index","slice","reduce","_","totalHeight","calculateRange","container","wrapper","clientHeight","visibleCount","start","max","end","min","offsetTop","style","marginTop","map","ele","data","width","e","preventDefault","target","scrollTo"],"sources":["/Users/liusu/Desktop/h5_free/game/node_modules/ahooks/es/useVirtualList/index.js"],"sourcesContent":["import { useEffect, useMemo, useState, useRef } from 'react';\nimport useEventListener from '../useEventListener';\nimport useLatest from '../useLatest';\nimport useMemoizedFn from '../useMemoizedFn';\nimport useSize from '../useSize';\nimport { getTargetElement } from '../utils/domTarget';\nimport { isNumber } from '../utils';\nconst useVirtualList = (list, options) => {\n  const {\n    containerTarget,\n    wrapperTarget,\n    itemHeight,\n    overscan = 5\n  } = options;\n  const itemHeightRef = useLatest(itemHeight);\n  const size = useSize(containerTarget);\n  const scrollTriggerByScrollToFunc = useRef(false);\n  const [targetList, setTargetList] = useState([]);\n  const getVisibleCount = (containerHeight, fromIndex) => {\n    if (isNumber(itemHeightRef.current)) {\n      return Math.ceil(containerHeight / itemHeightRef.current);\n    }\n    let sum = 0;\n    let endIndex = 0;\n    for (let i = fromIndex; i < list.length; i++) {\n      const height = itemHeightRef.current(i, list[i]);\n      sum += height;\n      endIndex = i;\n      if (sum >= containerHeight) {\n        break;\n      }\n    }\n    return endIndex - fromIndex;\n  };\n  const getOffset = scrollTop => {\n    if (isNumber(itemHeightRef.current)) {\n      return Math.floor(scrollTop / itemHeightRef.current) + 1;\n    }\n    let sum = 0;\n    let offset = 0;\n    for (let i = 0; i < list.length; i++) {\n      const height = itemHeightRef.current(i, list[i]);\n      sum += height;\n      if (sum >= scrollTop) {\n        offset = i;\n        break;\n      }\n    }\n    return offset + 1;\n  };\n  // 获取上部高度\n  const getDistanceTop = index => {\n    if (isNumber(itemHeightRef.current)) {\n      const height = index * itemHeightRef.current;\n      return height;\n    }\n    const height = list.slice(0, index).reduce((sum, _, i) => sum + itemHeightRef.current(i, list[i]), 0);\n    return height;\n  };\n  const totalHeight = useMemo(() => {\n    if (isNumber(itemHeightRef.current)) {\n      return list.length * itemHeightRef.current;\n    }\n    return list.reduce((sum, _, index) => sum + itemHeightRef.current(index, list[index]), 0);\n  }, [list]);\n  const calculateRange = () => {\n    const container = getTargetElement(containerTarget);\n    const wrapper = getTargetElement(wrapperTarget);\n    if (container && wrapper) {\n      const {\n        scrollTop,\n        clientHeight\n      } = container;\n      const offset = getOffset(scrollTop);\n      const visibleCount = getVisibleCount(clientHeight, offset);\n      const start = Math.max(0, offset - overscan);\n      const end = Math.min(list.length, offset + visibleCount + overscan);\n      const offsetTop = getDistanceTop(start);\n      wrapper.style.height = totalHeight - offsetTop + 'px';\n      wrapper.style.marginTop = offsetTop + 'px';\n      setTargetList(list.slice(start, end).map((ele, index) => ({\n        data: ele,\n        index: index + start\n      })));\n    }\n  };\n  useEffect(() => {\n    if (!(size === null || size === void 0 ? void 0 : size.width) || !(size === null || size === void 0 ? void 0 : size.height)) {\n      return;\n    }\n    calculateRange();\n  }, [size === null || size === void 0 ? void 0 : size.width, size === null || size === void 0 ? void 0 : size.height, list]);\n  useEventListener('scroll', e => {\n    if (scrollTriggerByScrollToFunc.current) {\n      scrollTriggerByScrollToFunc.current = false;\n      return;\n    }\n    e.preventDefault();\n    calculateRange();\n  }, {\n    target: containerTarget\n  });\n  const scrollTo = index => {\n    const container = getTargetElement(containerTarget);\n    if (container) {\n      scrollTriggerByScrollToFunc.current = true;\n      container.scrollTop = getDistanceTop(index);\n      calculateRange();\n    }\n  };\n  return [targetList, useMemoizedFn(scrollTo)];\n};\nexport default useVirtualList;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}