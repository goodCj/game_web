{"ast":null,"code":"import { useRef } from 'react';\nvar useRetryPlugin = function useRetryPlugin(fetchInstance, _ref) {\n  var retryInterval = _ref.retryInterval,\n    retryCount = _ref.retryCount;\n  var timerRef = useRef();\n  var countRef = useRef(0);\n  var triggerByRetry = useRef(false);\n  if (!retryCount) {\n    return {};\n  }\n  return {\n    onBefore: function onBefore() {\n      if (!triggerByRetry.current) {\n        countRef.current = 0;\n      }\n      triggerByRetry.current = false;\n      if (timerRef.current) {\n        clearTimeout(timerRef.current);\n      }\n    },\n    onSuccess: function onSuccess() {\n      countRef.current = 0;\n    },\n    onError: function onError() {\n      countRef.current += 1;\n      if (retryCount === -1 || countRef.current <= retryCount) {\n        // Exponential backoff\n        var timeout = retryInterval !== null && retryInterval !== void 0 ? retryInterval : Math.min(1000 * Math.pow(2, countRef.current), 30000);\n        timerRef.current = setTimeout(function () {\n          triggerByRetry.current = true;\n          fetchInstance.refresh();\n        }, timeout);\n      } else {\n        countRef.current = 0;\n      }\n    },\n    onCancel: function onCancel() {\n      countRef.current = 0;\n      if (timerRef.current) {\n        clearTimeout(timerRef.current);\n      }\n    }\n  };\n};\nexport default useRetryPlugin;","map":{"version":3,"names":["useRef","useRetryPlugin","fetchInstance","_ref","retryInterval","retryCount","timerRef","countRef","triggerByRetry","onBefore","current","clearTimeout","onSuccess","onError","timeout","Math","min","pow","setTimeout","refresh","onCancel"],"sources":["/Users/liusu/Desktop/h5_free/game/node_modules/ahooks/es/useRequest/src/plugins/useRetryPlugin.js"],"sourcesContent":["import { useRef } from 'react';\nconst useRetryPlugin = (fetchInstance, {\n  retryInterval,\n  retryCount\n}) => {\n  const timerRef = useRef();\n  const countRef = useRef(0);\n  const triggerByRetry = useRef(false);\n  if (!retryCount) {\n    return {};\n  }\n  return {\n    onBefore: () => {\n      if (!triggerByRetry.current) {\n        countRef.current = 0;\n      }\n      triggerByRetry.current = false;\n      if (timerRef.current) {\n        clearTimeout(timerRef.current);\n      }\n    },\n    onSuccess: () => {\n      countRef.current = 0;\n    },\n    onError: () => {\n      countRef.current += 1;\n      if (retryCount === -1 || countRef.current <= retryCount) {\n        // Exponential backoff\n        const timeout = retryInterval !== null && retryInterval !== void 0 ? retryInterval : Math.min(1000 * Math.pow(2, countRef.current), 30000);\n        timerRef.current = setTimeout(() => {\n          triggerByRetry.current = true;\n          fetchInstance.refresh();\n        }, timeout);\n      } else {\n        countRef.current = 0;\n      }\n    },\n    onCancel: () => {\n      countRef.current = 0;\n      if (timerRef.current) {\n        clearTimeout(timerRef.current);\n      }\n    }\n  };\n};\nexport default useRetryPlugin;"],"mappings":"AAAA,SAASA,MAAM,QAAQ,OAAO;AAC9B,IAAMC,cAAc,GAAG,SAAjBA,cAAcA,CAAIC,aAAa,EAAAC,IAAA,EAG/B;EAAA,IAFJC,aAAa,GAAAD,IAAA,CAAbC,aAAa;IACbC,UAAU,GAAAF,IAAA,CAAVE,UAAU;EAEV,IAAMC,QAAQ,GAAGN,MAAM,EAAE;EACzB,IAAMO,QAAQ,GAAGP,MAAM,CAAC,CAAC,CAAC;EAC1B,IAAMQ,cAAc,GAAGR,MAAM,CAAC,KAAK,CAAC;EACpC,IAAI,CAACK,UAAU,EAAE;IACf,OAAO,CAAC,CAAC;EACX;EACA,OAAO;IACLI,QAAQ,EAAE,SAAAA,SAAA,EAAM;MACd,IAAI,CAACD,cAAc,CAACE,OAAO,EAAE;QAC3BH,QAAQ,CAACG,OAAO,GAAG,CAAC;MACtB;MACAF,cAAc,CAACE,OAAO,GAAG,KAAK;MAC9B,IAAIJ,QAAQ,CAACI,OAAO,EAAE;QACpBC,YAAY,CAACL,QAAQ,CAACI,OAAO,CAAC;MAChC;IACF,CAAC;IACDE,SAAS,EAAE,SAAAA,UAAA,EAAM;MACfL,QAAQ,CAACG,OAAO,GAAG,CAAC;IACtB,CAAC;IACDG,OAAO,EAAE,SAAAA,QAAA,EAAM;MACbN,QAAQ,CAACG,OAAO,IAAI,CAAC;MACrB,IAAIL,UAAU,KAAK,CAAC,CAAC,IAAIE,QAAQ,CAACG,OAAO,IAAIL,UAAU,EAAE;QACvD;QACA,IAAMS,OAAO,GAAGV,aAAa,KAAK,IAAI,IAAIA,aAAa,KAAK,KAAK,CAAC,GAAGA,aAAa,GAAGW,IAAI,CAACC,GAAG,CAAC,IAAI,GAAGD,IAAI,CAACE,GAAG,CAAC,CAAC,EAAEV,QAAQ,CAACG,OAAO,CAAC,EAAE,KAAK,CAAC;QAC1IJ,QAAQ,CAACI,OAAO,GAAGQ,UAAU,CAAC,YAAM;UAClCV,cAAc,CAACE,OAAO,GAAG,IAAI;UAC7BR,aAAa,CAACiB,OAAO,EAAE;QACzB,CAAC,EAAEL,OAAO,CAAC;MACb,CAAC,MAAM;QACLP,QAAQ,CAACG,OAAO,GAAG,CAAC;MACtB;IACF,CAAC;IACDU,QAAQ,EAAE,SAAAA,SAAA,EAAM;MACdb,QAAQ,CAACG,OAAO,GAAG,CAAC;MACpB,IAAIJ,QAAQ,CAACI,OAAO,EAAE;QACpBC,YAAY,CAACL,QAAQ,CAACI,OAAO,CAAC;MAChC;IACF;EACF,CAAC;AACH,CAAC;AACD,eAAeT,cAAc"},"metadata":{},"sourceType":"module","externalDependencies":[]}