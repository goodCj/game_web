{"ast":null,"code":"import _slicedToArray from \"/Users/liusu/Desktop/h5_free/game/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { useRef, useState } from 'react';\nimport { getTargetElement } from '../utils/domTarget';\nimport useEffectWithTarget from '../utils/useEffectWithTarget';\nvar initRect = {\n  top: NaN,\n  left: NaN,\n  bottom: NaN,\n  right: NaN,\n  height: NaN,\n  width: NaN\n};\nvar initState = Object.assign({\n  text: ''\n}, initRect);\nfunction getRectFromSelection(selection) {\n  if (!selection) {\n    return initRect;\n  }\n  if (selection.rangeCount < 1) {\n    return initRect;\n  }\n  var range = selection.getRangeAt(0);\n  var _range$getBoundingCli = range.getBoundingClientRect(),\n    height = _range$getBoundingCli.height,\n    width = _range$getBoundingCli.width,\n    top = _range$getBoundingCli.top,\n    left = _range$getBoundingCli.left,\n    right = _range$getBoundingCli.right,\n    bottom = _range$getBoundingCli.bottom;\n  return {\n    height: height,\n    width: width,\n    top: top,\n    left: left,\n    right: right,\n    bottom: bottom\n  };\n}\nfunction useTextSelection(target) {\n  var _useState = useState(initState),\n    _useState2 = _slicedToArray(_useState, 2),\n    state = _useState2[0],\n    setState = _useState2[1];\n  var stateRef = useRef(state);\n  var isInRangeRef = useRef(false);\n  stateRef.current = state;\n  useEffectWithTarget(function () {\n    var el = getTargetElement(target, document);\n    if (!el) {\n      return;\n    }\n    var mouseupHandler = function mouseupHandler() {\n      var selObj = null;\n      var text = '';\n      var rect = initRect;\n      if (!window.getSelection) return;\n      selObj = window.getSelection();\n      text = selObj ? selObj.toString() : '';\n      if (text && isInRangeRef.current) {\n        rect = getRectFromSelection(selObj);\n        setState(Object.assign(Object.assign(Object.assign({}, state), {\n          text: text\n        }), rect));\n      }\n    };\n    // 任意点击都需要清空之前的 range\n    var mousedownHandler = function mousedownHandler(e) {\n      if (!window.getSelection) return;\n      if (stateRef.current.text) {\n        setState(Object.assign({}, initState));\n      }\n      isInRangeRef.current = false;\n      var selObj = window.getSelection();\n      if (!selObj) return;\n      selObj.removeAllRanges();\n      isInRangeRef.current = el.contains(e.target);\n    };\n    el.addEventListener('mouseup', mouseupHandler);\n    document.addEventListener('mousedown', mousedownHandler);\n    return function () {\n      el.removeEventListener('mouseup', mouseupHandler);\n      document.removeEventListener('mousedown', mousedownHandler);\n    };\n  }, [], target);\n  return state;\n}\nexport default useTextSelection;","map":{"version":3,"names":["useRef","useState","getTargetElement","useEffectWithTarget","initRect","top","NaN","left","bottom","right","height","width","initState","Object","assign","text","getRectFromSelection","selection","rangeCount","range","getRangeAt","_range$getBoundingCli","getBoundingClientRect","useTextSelection","target","_useState","_useState2","_slicedToArray","state","setState","stateRef","isInRangeRef","current","el","document","mouseupHandler","selObj","rect","window","getSelection","toString","mousedownHandler","e","removeAllRanges","contains","addEventListener","removeEventListener"],"sources":["/Users/liusu/Desktop/h5_free/game/node_modules/ahooks/es/useTextSelection/index.js"],"sourcesContent":["import { useRef, useState } from 'react';\nimport { getTargetElement } from '../utils/domTarget';\nimport useEffectWithTarget from '../utils/useEffectWithTarget';\nconst initRect = {\n  top: NaN,\n  left: NaN,\n  bottom: NaN,\n  right: NaN,\n  height: NaN,\n  width: NaN\n};\nconst initState = Object.assign({\n  text: ''\n}, initRect);\nfunction getRectFromSelection(selection) {\n  if (!selection) {\n    return initRect;\n  }\n  if (selection.rangeCount < 1) {\n    return initRect;\n  }\n  const range = selection.getRangeAt(0);\n  const {\n    height,\n    width,\n    top,\n    left,\n    right,\n    bottom\n  } = range.getBoundingClientRect();\n  return {\n    height,\n    width,\n    top,\n    left,\n    right,\n    bottom\n  };\n}\nfunction useTextSelection(target) {\n  const [state, setState] = useState(initState);\n  const stateRef = useRef(state);\n  const isInRangeRef = useRef(false);\n  stateRef.current = state;\n  useEffectWithTarget(() => {\n    const el = getTargetElement(target, document);\n    if (!el) {\n      return;\n    }\n    const mouseupHandler = () => {\n      let selObj = null;\n      let text = '';\n      let rect = initRect;\n      if (!window.getSelection) return;\n      selObj = window.getSelection();\n      text = selObj ? selObj.toString() : '';\n      if (text && isInRangeRef.current) {\n        rect = getRectFromSelection(selObj);\n        setState(Object.assign(Object.assign(Object.assign({}, state), {\n          text\n        }), rect));\n      }\n    };\n    // 任意点击都需要清空之前的 range\n    const mousedownHandler = e => {\n      if (!window.getSelection) return;\n      if (stateRef.current.text) {\n        setState(Object.assign({}, initState));\n      }\n      isInRangeRef.current = false;\n      const selObj = window.getSelection();\n      if (!selObj) return;\n      selObj.removeAllRanges();\n      isInRangeRef.current = el.contains(e.target);\n    };\n    el.addEventListener('mouseup', mouseupHandler);\n    document.addEventListener('mousedown', mousedownHandler);\n    return () => {\n      el.removeEventListener('mouseup', mouseupHandler);\n      document.removeEventListener('mousedown', mousedownHandler);\n    };\n  }, [], target);\n  return state;\n}\nexport default useTextSelection;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}