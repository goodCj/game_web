{"ast":null,"code":"import _slicedToArray from \"/Users/liusu/Desktop/h5_free/game/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport React, { forwardRef, useImperativeHandle, useRef, useState } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport { useDrag } from '@use-gesture/react';\nimport { useSpring, animated } from '@react-spring/web';\nimport { supportsPassive } from '../../utils/supports-passive';\nimport { nearest } from '../../utils/nearest';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { useLockScroll } from '../../utils/use-lock-scroll';\nimport { useMemoizedFn } from 'ahooks';\nvar defaultProps = {\n  handleDraggingOfContent: true\n};\nexport var FloatingPanel = forwardRef(function (p, ref) {\n  var _a, _b;\n  var props = mergeProps(defaultProps, p);\n  var anchors = props.anchors;\n  var maxHeight = (_a = anchors[anchors.length - 1]) !== null && _a !== void 0 ? _a : window.innerHeight;\n  var possibles = anchors.map(function (x) {\n    return -x;\n  });\n  var elementRef = useRef(null);\n  var headerRef = useRef(null);\n  var contentRef = useRef(null);\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    pulling = _useState2[0],\n    setPulling = _useState2[1];\n  var pullingRef = useRef(false);\n  var bounds = {\n    top: possibles[possibles.length - 1],\n    bottom: possibles[0]\n  };\n  var onHeightChange = useMemoizedFn((_b = props.onHeightChange) !== null && _b !== void 0 ? _b : function () {});\n  var _useSpring = useSpring(function () {\n      return {\n        y: bounds.bottom,\n        config: {\n          tension: 300\n        },\n        onChange: function onChange(result) {\n          onHeightChange(-result.value.y, y.isAnimating);\n        }\n      };\n    }),\n    _useSpring2 = _slicedToArray(_useSpring, 2),\n    y = _useSpring2[0].y,\n    api = _useSpring2[1];\n  useDrag(function (state) {\n    var _state$offset = _slicedToArray(state.offset, 2),\n      offsetY = _state$offset[1];\n    if (state.first) {\n      var target = state.event.target;\n      var header = headerRef.current;\n      if (header === target || (header === null || header === void 0 ? void 0 : header.contains(target))) {\n        pullingRef.current = true;\n      } else {\n        if (!props.handleDraggingOfContent) return;\n        var reachedTop = y.goal <= bounds.top;\n        var content = contentRef.current;\n        if (!content) return;\n        if (reachedTop) {\n          if (content.scrollTop <= 0 && state.direction[1] > 0) {\n            pullingRef.current = true;\n          }\n        } else {\n          pullingRef.current = true;\n        }\n      }\n    }\n    setPulling(pullingRef.current);\n    if (!pullingRef.current) return;\n    var event = state.event;\n    if (event.cancelable) {\n      event.preventDefault();\n    }\n    event.stopPropagation();\n    var nextY = offsetY;\n    if (state.last) {\n      pullingRef.current = false;\n      setPulling(false);\n      nextY = nearest(possibles, offsetY);\n    }\n    api.start({\n      y: nextY\n    });\n  }, {\n    axis: 'y',\n    bounds: bounds,\n    rubberband: true,\n    from: function from() {\n      return [0, y.get()];\n    },\n    pointer: {\n      touch: true\n    },\n    target: elementRef,\n    eventOptions: supportsPassive ? {\n      passive: false\n    } : false\n  });\n  useImperativeHandle(ref, function () {\n    return {\n      setHeight: function setHeight(height, options) {\n        api.start({\n          y: -height,\n          immediate: options === null || options === void 0 ? void 0 : options.immediate\n        });\n      }\n    };\n  }, [api]);\n  useLockScroll(elementRef, true);\n  return withNativeProps(props, React.createElement(animated.div, {\n    ref: elementRef,\n    className: 'adm-floating-panel',\n    style: {\n      height: Math.round(maxHeight),\n      translateY: y.to(function (y) {\n        return \"calc(100% + (\".concat(Math.round(y), \"px))\");\n      })\n    }\n  }, React.createElement(\"div\", {\n    className: 'adm-floating-panel-mask',\n    style: {\n      display: pulling ? 'block' : 'none'\n    }\n  }), React.createElement(\"div\", {\n    className: 'adm-floating-panel-header',\n    ref: headerRef\n  }, React.createElement(\"div\", {\n    className: 'adm-floating-panel-bar'\n  })), React.createElement(\"div\", {\n    className: 'adm-floating-panel-content',\n    ref: contentRef\n  }, props.children)));\n});","map":{"version":3,"names":["React","forwardRef","useImperativeHandle","useRef","useState","withNativeProps","useDrag","useSpring","animated","supportsPassive","nearest","mergeProps","useLockScroll","useMemoizedFn","defaultProps","handleDraggingOfContent","FloatingPanel","p","ref","_a","_b","props","anchors","maxHeight","length","window","innerHeight","possibles","map","x","elementRef","headerRef","contentRef","_useState","_useState2","_slicedToArray","pulling","setPulling","pullingRef","bounds","top","bottom","onHeightChange","_useSpring","y","config","tension","onChange","result","value","isAnimating","_useSpring2","api","state","_state$offset","offset","offsetY","first","target","event","header","current","contains","reachedTop","goal","content","scrollTop","direction","cancelable","preventDefault","stopPropagation","nextY","last","start","axis","rubberband","from","get","pointer","touch","eventOptions","passive","setHeight","height","options","immediate","createElement","div","className","style","Math","round","translateY","to","concat","display","children"],"sources":["/Users/liusu/Desktop/h5_free/game/node_modules/antd-mobile/es/components/floating-panel/floating-panel.js"],"sourcesContent":["import React, { forwardRef, useImperativeHandle, useRef, useState } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport { useDrag } from '@use-gesture/react';\nimport { useSpring, animated } from '@react-spring/web';\nimport { supportsPassive } from '../../utils/supports-passive';\nimport { nearest } from '../../utils/nearest';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { useLockScroll } from '../../utils/use-lock-scroll';\nimport { useMemoizedFn } from 'ahooks';\nconst defaultProps = {\n  handleDraggingOfContent: true\n};\nexport const FloatingPanel = forwardRef((p, ref) => {\n  var _a, _b;\n  const props = mergeProps(defaultProps, p);\n  const {\n    anchors\n  } = props;\n  const maxHeight = (_a = anchors[anchors.length - 1]) !== null && _a !== void 0 ? _a : window.innerHeight;\n  const possibles = anchors.map(x => -x);\n  const elementRef = useRef(null);\n  const headerRef = useRef(null);\n  const contentRef = useRef(null);\n  const [pulling, setPulling] = useState(false);\n  const pullingRef = useRef(false);\n  const bounds = {\n    top: possibles[possibles.length - 1],\n    bottom: possibles[0]\n  };\n  const onHeightChange = useMemoizedFn((_b = props.onHeightChange) !== null && _b !== void 0 ? _b : () => {});\n  const [{\n    y\n  }, api] = useSpring(() => ({\n    y: bounds.bottom,\n    config: {\n      tension: 300\n    },\n    onChange: result => {\n      onHeightChange(-result.value.y, y.isAnimating);\n    }\n  }));\n  useDrag(state => {\n    const [, offsetY] = state.offset;\n    if (state.first) {\n      const target = state.event.target;\n      const header = headerRef.current;\n      if (header === target || (header === null || header === void 0 ? void 0 : header.contains(target))) {\n        pullingRef.current = true;\n      } else {\n        if (!props.handleDraggingOfContent) return;\n        const reachedTop = y.goal <= bounds.top;\n        const content = contentRef.current;\n        if (!content) return;\n        if (reachedTop) {\n          if (content.scrollTop <= 0 && state.direction[1] > 0) {\n            pullingRef.current = true;\n          }\n        } else {\n          pullingRef.current = true;\n        }\n      }\n    }\n    setPulling(pullingRef.current);\n    if (!pullingRef.current) return;\n    const {\n      event\n    } = state;\n    if (event.cancelable) {\n      event.preventDefault();\n    }\n    event.stopPropagation();\n    let nextY = offsetY;\n    if (state.last) {\n      pullingRef.current = false;\n      setPulling(false);\n      nextY = nearest(possibles, offsetY);\n    }\n    api.start({\n      y: nextY\n    });\n  }, {\n    axis: 'y',\n    bounds,\n    rubberband: true,\n    from: () => [0, y.get()],\n    pointer: {\n      touch: true\n    },\n    target: elementRef,\n    eventOptions: supportsPassive ? {\n      passive: false\n    } : false\n  });\n  useImperativeHandle(ref, () => ({\n    setHeight: (height, options) => {\n      api.start({\n        y: -height,\n        immediate: options === null || options === void 0 ? void 0 : options.immediate\n      });\n    }\n  }), [api]);\n  useLockScroll(elementRef, true);\n  return withNativeProps(props, React.createElement(animated.div, {\n    ref: elementRef,\n    className: 'adm-floating-panel',\n    style: {\n      height: Math.round(maxHeight),\n      translateY: y.to(y => `calc(100% + (${Math.round(y)}px))`)\n    }\n  }, React.createElement(\"div\", {\n    className: 'adm-floating-panel-mask',\n    style: {\n      display: pulling ? 'block' : 'none'\n    }\n  }), React.createElement(\"div\", {\n    className: 'adm-floating-panel-header',\n    ref: headerRef\n  }, React.createElement(\"div\", {\n    className: 'adm-floating-panel-bar'\n  })), React.createElement(\"div\", {\n    className: 'adm-floating-panel-content',\n    ref: contentRef\n  }, props.children)));\n});"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}