{"ast":null,"code":"import _slicedToArray from \"/Users/liusu/Desktop/h5_free/game/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport React, { forwardRef, useImperativeHandle, useRef } from 'react';\nimport { useDrag } from '@use-gesture/react';\nimport { useSpring, animated } from '@react-spring/web';\nimport { Slide } from './slide';\nimport { convertPx } from '../../utils/convert-px';\nimport { bound } from '../../utils/bound';\nvar classPrefix = \"adm-image-viewer\";\nexport var Slides = forwardRef(function (props, ref) {\n  var slideWidth = window.innerWidth + convertPx(16);\n  var _useSpring = useSpring(function () {\n      return {\n        x: props.defaultIndex * slideWidth,\n        config: {\n          tension: 250,\n          clamp: true\n        }\n      };\n    }),\n    _useSpring2 = _slicedToArray(_useSpring, 2),\n    x = _useSpring2[0].x,\n    api = _useSpring2[1];\n  var count = props.images.length;\n  function swipeTo(index) {\n    var immediate = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    var _a;\n    var i = bound(index, 0, count - 1);\n    (_a = props.onIndexChange) === null || _a === void 0 ? void 0 : _a.call(props, i);\n    api.start({\n      x: i * slideWidth,\n      immediate: immediate\n    });\n  }\n  useImperativeHandle(ref, function () {\n    return {\n      swipeTo: swipeTo\n    };\n  });\n  var dragLockRef = useRef(false);\n  var bind = useDrag(function (state) {\n    if (dragLockRef.current) return;\n    var _state$offset = _slicedToArray(state.offset, 1),\n      offsetX = _state$offset[0];\n    if (state.last) {\n      var minIndex = Math.floor(offsetX / slideWidth);\n      var maxIndex = minIndex + 1;\n      var velocityOffset = Math.min(state.velocity[0] * 2000, slideWidth) * state.direction[0];\n      swipeTo(bound(Math.round((offsetX + velocityOffset) / slideWidth), minIndex, maxIndex));\n    } else {\n      api.start({\n        x: offsetX,\n        immediate: true\n      });\n    }\n  }, {\n    transform: function transform(_ref) {\n      var _ref2 = _slicedToArray(_ref, 2),\n        x = _ref2[0],\n        y = _ref2[1];\n      return [-x, y];\n    },\n    from: function from() {\n      return [x.get(), 0];\n    },\n    bounds: function bounds() {\n      return {\n        left: 0,\n        right: (count - 1) * slideWidth\n      };\n    },\n    rubberband: true,\n    axis: 'x',\n    pointer: {\n      touch: true\n    }\n  });\n  return React.createElement(\"div\", Object.assign({\n    className: \"\".concat(classPrefix, \"-slides\")\n  }, bind()), React.createElement(animated.div, {\n    className: \"\".concat(classPrefix, \"-indicator\")\n  }, x.to(function (v) {\n    var index = bound(Math.round(v / slideWidth), 0, count - 1);\n    return \"\".concat(index + 1, \" / \").concat(count);\n  })), React.createElement(animated.div, {\n    className: \"\".concat(classPrefix, \"-slides-inner\"),\n    style: {\n      x: x.to(function (x) {\n        return -x;\n      })\n    }\n  }, props.images.map(function (image, index) {\n    return React.createElement(Slide, {\n      key: index,\n      image: image,\n      onTap: props.onTap,\n      maxZoom: props.maxZoom,\n      onZoomChange: function onZoomChange(zoom) {\n        if (zoom !== 1) {\n          var _index = Math.round(x.get() / slideWidth);\n          api.start({\n            x: _index * slideWidth\n          });\n        }\n      },\n      dragLockRef: dragLockRef\n    });\n  })));\n});","map":{"version":3,"names":["React","forwardRef","useImperativeHandle","useRef","useDrag","useSpring","animated","Slide","convertPx","bound","classPrefix","Slides","props","ref","slideWidth","window","innerWidth","_useSpring","x","defaultIndex","config","tension","clamp","_useSpring2","_slicedToArray","api","count","images","length","swipeTo","index","immediate","arguments","undefined","_a","i","onIndexChange","call","start","dragLockRef","bind","state","current","_state$offset","offset","offsetX","last","minIndex","Math","floor","maxIndex","velocityOffset","min","velocity","direction","round","transform","_ref","_ref2","y","from","get","bounds","left","right","rubberband","axis","pointer","touch","createElement","Object","assign","className","concat","div","to","v","style","map","image","key","onTap","maxZoom","onZoomChange","zoom"],"sources":["/Users/liusu/Desktop/h5_free/game/node_modules/antd-mobile/es/components/image-viewer/slides.js"],"sourcesContent":["import React, { forwardRef, useImperativeHandle, useRef } from 'react';\nimport { useDrag } from '@use-gesture/react';\nimport { useSpring, animated } from '@react-spring/web';\nimport { Slide } from './slide';\nimport { convertPx } from '../../utils/convert-px';\nimport { bound } from '../../utils/bound';\nconst classPrefix = `adm-image-viewer`;\nexport const Slides = forwardRef((props, ref) => {\n  const slideWidth = window.innerWidth + convertPx(16);\n  const [{\n    x\n  }, api] = useSpring(() => ({\n    x: props.defaultIndex * slideWidth,\n    config: {\n      tension: 250,\n      clamp: true\n    }\n  }));\n  const count = props.images.length;\n  function swipeTo(index, immediate = false) {\n    var _a;\n    const i = bound(index, 0, count - 1);\n    (_a = props.onIndexChange) === null || _a === void 0 ? void 0 : _a.call(props, i);\n    api.start({\n      x: i * slideWidth,\n      immediate\n    });\n  }\n  useImperativeHandle(ref, () => ({\n    swipeTo\n  }));\n  const dragLockRef = useRef(false);\n  const bind = useDrag(state => {\n    if (dragLockRef.current) return;\n    const [offsetX] = state.offset;\n    if (state.last) {\n      const minIndex = Math.floor(offsetX / slideWidth);\n      const maxIndex = minIndex + 1;\n      const velocityOffset = Math.min(state.velocity[0] * 2000, slideWidth) * state.direction[0];\n      swipeTo(bound(Math.round((offsetX + velocityOffset) / slideWidth), minIndex, maxIndex));\n    } else {\n      api.start({\n        x: offsetX,\n        immediate: true\n      });\n    }\n  }, {\n    transform: ([x, y]) => [-x, y],\n    from: () => [x.get(), 0],\n    bounds: () => {\n      return {\n        left: 0,\n        right: (count - 1) * slideWidth\n      };\n    },\n    rubberband: true,\n    axis: 'x',\n    pointer: {\n      touch: true\n    }\n  });\n  return React.createElement(\"div\", Object.assign({\n    className: `${classPrefix}-slides`\n  }, bind()), React.createElement(animated.div, {\n    className: `${classPrefix}-indicator`\n  }, x.to(v => {\n    const index = bound(Math.round(v / slideWidth), 0, count - 1);\n    return `${index + 1} / ${count}`;\n  })), React.createElement(animated.div, {\n    className: `${classPrefix}-slides-inner`,\n    style: {\n      x: x.to(x => -x)\n    }\n  }, props.images.map((image, index) => React.createElement(Slide, {\n    key: index,\n    image: image,\n    onTap: props.onTap,\n    maxZoom: props.maxZoom,\n    onZoomChange: zoom => {\n      if (zoom !== 1) {\n        const index = Math.round(x.get() / slideWidth);\n        api.start({\n          x: index * slideWidth\n        });\n      }\n    },\n    dragLockRef: dragLockRef\n  }))));\n});"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}