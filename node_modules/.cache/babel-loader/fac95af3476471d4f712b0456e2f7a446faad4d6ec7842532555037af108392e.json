{"ast":null,"code":"import _slicedToArray from \"/Users/liusu/Desktop/h5_free/game/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport dayjs from 'dayjs';\nimport { useEffect, useMemo, useState } from 'react';\nimport useLatest from '../useLatest';\nimport { isNumber } from '../utils/index';\nvar calcLeft = function calcLeft(target) {\n  if (!target) {\n    return 0;\n  }\n  // https://stackoverflow.com/questions/4310953/invalid-date-in-safari\n  var left = dayjs(target).valueOf() - Date.now();\n  return left < 0 ? 0 : left;\n};\nvar parseMs = function parseMs(milliseconds) {\n  return {\n    days: Math.floor(milliseconds / 86400000),\n    hours: Math.floor(milliseconds / 3600000) % 24,\n    minutes: Math.floor(milliseconds / 60000) % 60,\n    seconds: Math.floor(milliseconds / 1000) % 60,\n    milliseconds: Math.floor(milliseconds) % 1000\n  };\n};\nvar useCountdown = function useCountdown() {\n  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var _ref = options || {},\n    leftTime = _ref.leftTime,\n    targetDate = _ref.targetDate,\n    _ref$interval = _ref.interval,\n    interval = _ref$interval === void 0 ? 1000 : _ref$interval,\n    onEnd = _ref.onEnd;\n  var target = useMemo(function () {\n    if ('leftTime' in options) {\n      return isNumber(leftTime) && leftTime > 0 ? Date.now() + leftTime : undefined;\n    } else {\n      return targetDate;\n    }\n  }, [leftTime, targetDate]);\n  var _useState = useState(function () {\n      return calcLeft(target);\n    }),\n    _useState2 = _slicedToArray(_useState, 2),\n    timeLeft = _useState2[0],\n    setTimeLeft = _useState2[1];\n  var onEndRef = useLatest(onEnd);\n  useEffect(function () {\n    if (!target) {\n      // for stop\n      setTimeLeft(0);\n      return;\n    }\n    // 立即执行一次\n    setTimeLeft(calcLeft(target));\n    var timer = setInterval(function () {\n      var _a;\n      var targetLeft = calcLeft(target);\n      setTimeLeft(targetLeft);\n      if (targetLeft === 0) {\n        clearInterval(timer);\n        (_a = onEndRef.current) === null || _a === void 0 ? void 0 : _a.call(onEndRef);\n      }\n    }, interval);\n    return function () {\n      return clearInterval(timer);\n    };\n  }, [target, interval]);\n  var formattedRes = useMemo(function () {\n    return parseMs(timeLeft);\n  }, [timeLeft]);\n  return [timeLeft, formattedRes];\n};\nexport default useCountdown;","map":{"version":3,"names":["dayjs","useEffect","useMemo","useState","useLatest","isNumber","calcLeft","target","left","valueOf","Date","now","parseMs","milliseconds","days","Math","floor","hours","minutes","seconds","useCountdown","options","arguments","length","undefined","_ref","leftTime","targetDate","_ref$interval","interval","onEnd","_useState","_useState2","_slicedToArray","timeLeft","setTimeLeft","onEndRef","timer","setInterval","_a","targetLeft","clearInterval","current","call","formattedRes"],"sources":["/Users/liusu/Desktop/h5_free/game/node_modules/ahooks/es/useCountDown/index.js"],"sourcesContent":["import dayjs from 'dayjs';\nimport { useEffect, useMemo, useState } from 'react';\nimport useLatest from '../useLatest';\nimport { isNumber } from '../utils/index';\nconst calcLeft = target => {\n  if (!target) {\n    return 0;\n  }\n  // https://stackoverflow.com/questions/4310953/invalid-date-in-safari\n  const left = dayjs(target).valueOf() - Date.now();\n  return left < 0 ? 0 : left;\n};\nconst parseMs = milliseconds => {\n  return {\n    days: Math.floor(milliseconds / 86400000),\n    hours: Math.floor(milliseconds / 3600000) % 24,\n    minutes: Math.floor(milliseconds / 60000) % 60,\n    seconds: Math.floor(milliseconds / 1000) % 60,\n    milliseconds: Math.floor(milliseconds) % 1000\n  };\n};\nconst useCountdown = (options = {}) => {\n  const {\n    leftTime,\n    targetDate,\n    interval = 1000,\n    onEnd\n  } = options || {};\n  const target = useMemo(() => {\n    if ('leftTime' in options) {\n      return isNumber(leftTime) && leftTime > 0 ? Date.now() + leftTime : undefined;\n    } else {\n      return targetDate;\n    }\n  }, [leftTime, targetDate]);\n  const [timeLeft, setTimeLeft] = useState(() => calcLeft(target));\n  const onEndRef = useLatest(onEnd);\n  useEffect(() => {\n    if (!target) {\n      // for stop\n      setTimeLeft(0);\n      return;\n    }\n    // 立即执行一次\n    setTimeLeft(calcLeft(target));\n    const timer = setInterval(() => {\n      var _a;\n      const targetLeft = calcLeft(target);\n      setTimeLeft(targetLeft);\n      if (targetLeft === 0) {\n        clearInterval(timer);\n        (_a = onEndRef.current) === null || _a === void 0 ? void 0 : _a.call(onEndRef);\n      }\n    }, interval);\n    return () => clearInterval(timer);\n  }, [target, interval]);\n  const formattedRes = useMemo(() => parseMs(timeLeft), [timeLeft]);\n  return [timeLeft, formattedRes];\n};\nexport default useCountdown;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}