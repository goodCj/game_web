{"ast":null,"code":"import _regeneratorRuntime from \"/Users/liusu/Desktop/h5_free/game/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _slicedToArray from \"/Users/liusu/Desktop/h5_free/game/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { __awaiter } from \"tslib\";\nimport { mergeProps } from '../../utils/with-default-props';\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useLockFn, useThrottleFn } from 'ahooks';\nimport { withNativeProps } from '../../utils/native-props';\nimport { getScrollParent } from '../../utils/get-scroll-parent';\nimport { useConfig } from '../config-provider';\nimport DotLoading from '../dot-loading';\nfunction isWindow(element) {\n  return element === window;\n}\nvar classPrefix = \"adm-infinite-scroll\";\nvar defaultProps = {\n  threshold: 250,\n  children: function children(hasMore, failed, retry) {\n    return React.createElement(InfiniteScrollContent, {\n      hasMore: hasMore,\n      failed: failed,\n      retry: retry\n    });\n  }\n};\nexport var InfiniteScroll = function InfiniteScroll(p) {\n  var props = mergeProps(defaultProps, p);\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    failed = _useState2[0],\n    setFailed = _useState2[1];\n  var doLoadMore = useLockFn(function (isRetry) {\n    return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return props.loadMore(isRetry);\n          case 3:\n            _context.next = 9;\n            break;\n          case 5:\n            _context.prev = 5;\n            _context.t0 = _context[\"catch\"](0);\n            setFailed(true);\n            throw _context.t0;\n          case 9:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee, null, [[0, 5]]);\n    }));\n  });\n  var elementRef = useRef(null);\n  // Prevent duplicated trigger of `check` function\n  var _useState3 = useState({}),\n    _useState4 = _slicedToArray(_useState3, 2),\n    flag = _useState4[0],\n    setFlag = _useState4[1];\n  var nextFlagRef = useRef(flag);\n  var _useState5 = useState(),\n    _useState6 = _slicedToArray(_useState5, 2),\n    scrollParent = _useState6[0],\n    setScrollParent = _useState6[1];\n  var _useThrottleFn = useThrottleFn(function () {\n      return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var element, parent, rect, elementTop, current, nextFlag;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(nextFlagRef.current !== flag)) {\n                _context2.next = 2;\n                break;\n              }\n              return _context2.abrupt(\"return\");\n            case 2:\n              if (props.hasMore) {\n                _context2.next = 4;\n                break;\n              }\n              return _context2.abrupt(\"return\");\n            case 4:\n              element = elementRef.current;\n              if (element) {\n                _context2.next = 7;\n                break;\n              }\n              return _context2.abrupt(\"return\");\n            case 7:\n              if (element.offsetParent) {\n                _context2.next = 9;\n                break;\n              }\n              return _context2.abrupt(\"return\");\n            case 9:\n              parent = getScrollParent(element);\n              setScrollParent(parent);\n              if (parent) {\n                _context2.next = 13;\n                break;\n              }\n              return _context2.abrupt(\"return\");\n            case 13:\n              rect = element.getBoundingClientRect();\n              elementTop = rect.top;\n              current = isWindow(parent) ? window.innerHeight : parent.getBoundingClientRect().bottom;\n              if (!(current >= elementTop - props.threshold)) {\n                _context2.next = 22;\n                break;\n              }\n              nextFlag = {};\n              nextFlagRef.current = nextFlag;\n              _context2.next = 21;\n              return doLoadMore(false);\n            case 21:\n              setFlag(nextFlag);\n            case 22:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2);\n      }));\n    }, {\n      wait: 100,\n      leading: true,\n      trailing: true\n    }),\n    check = _useThrottleFn.run;\n  // Make sure to trigger `loadMore` when content changes\n  useEffect(function () {\n    check();\n  });\n  useEffect(function () {\n    var element = elementRef.current;\n    if (!element) return;\n    if (!scrollParent) return;\n    function onScroll() {\n      check();\n    }\n    scrollParent.addEventListener('scroll', onScroll);\n    return function () {\n      scrollParent.removeEventListener('scroll', onScroll);\n    };\n  }, [scrollParent]);\n  function retry() {\n    return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n      return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n        while (1) switch (_context3.prev = _context3.next) {\n          case 0:\n            setFailed(false);\n            _context3.next = 3;\n            return doLoadMore(true);\n          case 3:\n            setFlag(nextFlagRef.current);\n          case 4:\n          case \"end\":\n            return _context3.stop();\n        }\n      }, _callee3);\n    }));\n  }\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classPrefix,\n    ref: elementRef\n  }, typeof props.children === 'function' ? props.children(props.hasMore, failed, retry) : props.children));\n};\nvar InfiniteScrollContent = function InfiniteScrollContent(props) {\n  var _useConfig = useConfig(),\n    locale = _useConfig.locale;\n  if (!props.hasMore) {\n    return React.createElement(\"span\", null, locale.InfiniteScroll.noMore);\n  }\n  if (props.failed) {\n    return React.createElement(\"span\", null, React.createElement(\"span\", {\n      className: \"\".concat(classPrefix, \"-failed-text\")\n    }, locale.InfiniteScroll.failedToLoad), React.createElement(\"a\", {\n      onClick: function onClick() {\n        props.retry();\n      }\n    }, locale.InfiniteScroll.retry));\n  }\n  return React.createElement(React.Fragment, null, React.createElement(\"span\", null, locale.common.loading), React.createElement(DotLoading, null));\n};","map":{"version":3,"names":["__awaiter","mergeProps","React","useEffect","useRef","useState","useLockFn","useThrottleFn","withNativeProps","getScrollParent","useConfig","DotLoading","isWindow","element","window","classPrefix","defaultProps","threshold","children","hasMore","failed","retry","createElement","InfiniteScrollContent","InfiniteScroll","p","props","_useState","_useState2","_slicedToArray","setFailed","doLoadMore","isRetry","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","loadMore","t0","stop","elementRef","_useState3","_useState4","flag","setFlag","nextFlagRef","_useState5","_useState6","scrollParent","setScrollParent","_useThrottleFn","_callee2","parent","rect","elementTop","current","nextFlag","_callee2$","_context2","abrupt","offsetParent","getBoundingClientRect","top","innerHeight","bottom","wait","leading","trailing","check","run","onScroll","addEventListener","removeEventListener","_callee3","_callee3$","_context3","className","ref","_useConfig","locale","noMore","concat","failedToLoad","onClick","Fragment","common","loading"],"sources":["/Users/liusu/Desktop/h5_free/game/node_modules/antd-mobile/es/components/infinite-scroll/infinite-scroll.js"],"sourcesContent":["import { __awaiter } from \"tslib\";\nimport { mergeProps } from '../../utils/with-default-props';\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useLockFn, useThrottleFn } from 'ahooks';\nimport { withNativeProps } from '../../utils/native-props';\nimport { getScrollParent } from '../../utils/get-scroll-parent';\nimport { useConfig } from '../config-provider';\nimport DotLoading from '../dot-loading';\nfunction isWindow(element) {\n  return element === window;\n}\nconst classPrefix = `adm-infinite-scroll`;\nconst defaultProps = {\n  threshold: 250,\n  children: (hasMore, failed, retry) => React.createElement(InfiniteScrollContent, {\n    hasMore: hasMore,\n    failed: failed,\n    retry: retry\n  })\n};\nexport const InfiniteScroll = p => {\n  const props = mergeProps(defaultProps, p);\n  const [failed, setFailed] = useState(false);\n  const doLoadMore = useLockFn(isRetry => __awaiter(void 0, void 0, void 0, function* () {\n    try {\n      yield props.loadMore(isRetry);\n    } catch (e) {\n      setFailed(true);\n      throw e;\n    }\n  }));\n  const elementRef = useRef(null);\n  // Prevent duplicated trigger of `check` function\n  const [flag, setFlag] = useState({});\n  const nextFlagRef = useRef(flag);\n  const [scrollParent, setScrollParent] = useState();\n  const {\n    run: check\n  } = useThrottleFn(() => __awaiter(void 0, void 0, void 0, function* () {\n    if (nextFlagRef.current !== flag) return;\n    if (!props.hasMore) return;\n    const element = elementRef.current;\n    if (!element) return;\n    if (!element.offsetParent) return;\n    const parent = getScrollParent(element);\n    setScrollParent(parent);\n    if (!parent) return;\n    const rect = element.getBoundingClientRect();\n    const elementTop = rect.top;\n    const current = isWindow(parent) ? window.innerHeight : parent.getBoundingClientRect().bottom;\n    if (current >= elementTop - props.threshold) {\n      const nextFlag = {};\n      nextFlagRef.current = nextFlag;\n      yield doLoadMore(false);\n      setFlag(nextFlag);\n    }\n  }), {\n    wait: 100,\n    leading: true,\n    trailing: true\n  });\n  // Make sure to trigger `loadMore` when content changes\n  useEffect(() => {\n    check();\n  });\n  useEffect(() => {\n    const element = elementRef.current;\n    if (!element) return;\n    if (!scrollParent) return;\n    function onScroll() {\n      check();\n    }\n    scrollParent.addEventListener('scroll', onScroll);\n    return () => {\n      scrollParent.removeEventListener('scroll', onScroll);\n    };\n  }, [scrollParent]);\n  function retry() {\n    return __awaiter(this, void 0, void 0, function* () {\n      setFailed(false);\n      yield doLoadMore(true);\n      setFlag(nextFlagRef.current);\n    });\n  }\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classPrefix,\n    ref: elementRef\n  }, typeof props.children === 'function' ? props.children(props.hasMore, failed, retry) : props.children));\n};\nconst InfiniteScrollContent = props => {\n  const {\n    locale\n  } = useConfig();\n  if (!props.hasMore) {\n    return React.createElement(\"span\", null, locale.InfiniteScroll.noMore);\n  }\n  if (props.failed) {\n    return React.createElement(\"span\", null, React.createElement(\"span\", {\n      className: `${classPrefix}-failed-text`\n    }, locale.InfiniteScroll.failedToLoad), React.createElement(\"a\", {\n      onClick: () => {\n        props.retry();\n      }\n    }, locale.InfiniteScroll.retry));\n  }\n  return React.createElement(React.Fragment, null, React.createElement(\"span\", null, locale.common.loading), React.createElement(DotLoading, null));\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}