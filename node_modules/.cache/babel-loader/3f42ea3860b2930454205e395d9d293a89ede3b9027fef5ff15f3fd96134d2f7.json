{"ast":null,"code":"import _slicedToArray from \"/Users/liusu/Desktop/h5_free/game/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { useEffect, useRef, useState } from 'react';\nimport useLatest from '../useLatest';\nimport useMemoizedFn from '../useMemoizedFn';\nimport useUnmount from '../useUnmount';\nexport var ReadyState;\n(function (ReadyState) {\n  ReadyState[ReadyState[\"Connecting\"] = 0] = \"Connecting\";\n  ReadyState[ReadyState[\"Open\"] = 1] = \"Open\";\n  ReadyState[ReadyState[\"Closing\"] = 2] = \"Closing\";\n  ReadyState[ReadyState[\"Closed\"] = 3] = \"Closed\";\n})(ReadyState || (ReadyState = {}));\nexport default function useWebSocket(socketUrl) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var _options$reconnectLim = options.reconnectLimit,\n    reconnectLimit = _options$reconnectLim === void 0 ? 3 : _options$reconnectLim,\n    _options$reconnectInt = options.reconnectInterval,\n    reconnectInterval = _options$reconnectInt === void 0 ? 3 * 1000 : _options$reconnectInt,\n    _options$manual = options.manual,\n    manual = _options$manual === void 0 ? false : _options$manual,\n    onOpen = options.onOpen,\n    onClose = options.onClose,\n    onMessage = options.onMessage,\n    onError = options.onError,\n    protocols = options.protocols;\n  var onOpenRef = useLatest(onOpen);\n  var onCloseRef = useLatest(onClose);\n  var onMessageRef = useLatest(onMessage);\n  var onErrorRef = useLatest(onError);\n  var reconnectTimesRef = useRef(0);\n  var reconnectTimerRef = useRef();\n  var websocketRef = useRef();\n  var unmountedRef = useRef(false);\n  var _useState = useState(),\n    _useState2 = _slicedToArray(_useState, 2),\n    latestMessage = _useState2[0],\n    setLatestMessage = _useState2[1];\n  var _useState3 = useState(ReadyState.Closed),\n    _useState4 = _slicedToArray(_useState3, 2),\n    readyState = _useState4[0],\n    setReadyState = _useState4[1];\n  var reconnect = function reconnect() {\n    var _a;\n    if (reconnectTimesRef.current < reconnectLimit && ((_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.readyState) !== ReadyState.Open) {\n      if (reconnectTimerRef.current) {\n        clearTimeout(reconnectTimerRef.current);\n      }\n      reconnectTimerRef.current = setTimeout(function () {\n        // eslint-disable-next-line @typescript-eslint/no-use-before-define\n        connectWs();\n        reconnectTimesRef.current++;\n      }, reconnectInterval);\n    }\n  };\n  var connectWs = function connectWs() {\n    if (reconnectTimerRef.current) {\n      clearTimeout(reconnectTimerRef.current);\n    }\n    if (websocketRef.current) {\n      websocketRef.current.close();\n    }\n    var ws = new WebSocket(socketUrl, protocols);\n    setReadyState(ReadyState.Connecting);\n    ws.onerror = function (event) {\n      var _a;\n      if (unmountedRef.current) {\n        return;\n      }\n      reconnect();\n      (_a = onErrorRef.current) === null || _a === void 0 ? void 0 : _a.call(onErrorRef, event, ws);\n      setReadyState(ws.readyState || ReadyState.Closed);\n    };\n    ws.onopen = function (event) {\n      var _a;\n      if (unmountedRef.current) {\n        return;\n      }\n      (_a = onOpenRef.current) === null || _a === void 0 ? void 0 : _a.call(onOpenRef, event, ws);\n      reconnectTimesRef.current = 0;\n      setReadyState(ws.readyState || ReadyState.Open);\n    };\n    ws.onmessage = function (message) {\n      var _a;\n      if (unmountedRef.current) {\n        return;\n      }\n      (_a = onMessageRef.current) === null || _a === void 0 ? void 0 : _a.call(onMessageRef, message, ws);\n      setLatestMessage(message);\n    };\n    ws.onclose = function (event) {\n      var _a;\n      if (unmountedRef.current) {\n        return;\n      }\n      reconnect();\n      (_a = onCloseRef.current) === null || _a === void 0 ? void 0 : _a.call(onCloseRef, event, ws);\n      setReadyState(ws.readyState || ReadyState.Closed);\n    };\n    websocketRef.current = ws;\n  };\n  var sendMessage = function sendMessage(message) {\n    var _a;\n    if (readyState === ReadyState.Open) {\n      (_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.send(message);\n    } else {\n      throw new Error('WebSocket disconnected');\n    }\n  };\n  var connect = function connect() {\n    reconnectTimesRef.current = 0;\n    connectWs();\n  };\n  var disconnect = function disconnect() {\n    var _a;\n    if (reconnectTimerRef.current) {\n      clearTimeout(reconnectTimerRef.current);\n    }\n    reconnectTimesRef.current = reconnectLimit;\n    (_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.close();\n  };\n  useEffect(function () {\n    if (!manual) {\n      connect();\n    }\n  }, [socketUrl, manual]);\n  useUnmount(function () {\n    unmountedRef.current = true;\n    disconnect();\n  });\n  return {\n    latestMessage: latestMessage,\n    sendMessage: useMemoizedFn(sendMessage),\n    connect: useMemoizedFn(connect),\n    disconnect: useMemoizedFn(disconnect),\n    readyState: readyState,\n    webSocketIns: websocketRef.current\n  };\n}","map":{"version":3,"names":["useEffect","useRef","useState","useLatest","useMemoizedFn","useUnmount","ReadyState","useWebSocket","socketUrl","options","arguments","length","undefined","_options$reconnectLim","reconnectLimit","_options$reconnectInt","reconnectInterval","_options$manual","manual","onOpen","onClose","onMessage","onError","protocols","onOpenRef","onCloseRef","onMessageRef","onErrorRef","reconnectTimesRef","reconnectTimerRef","websocketRef","unmountedRef","_useState","_useState2","_slicedToArray","latestMessage","setLatestMessage","_useState3","Closed","_useState4","readyState","setReadyState","reconnect","_a","current","Open","clearTimeout","setTimeout","connectWs","close","ws","WebSocket","Connecting","onerror","event","call","onopen","onmessage","message","onclose","sendMessage","send","Error","connect","disconnect","webSocketIns"],"sources":["/Users/liusu/Desktop/h5_free/game/node_modules/ahooks/es/useWebSocket/index.js"],"sourcesContent":["import { useEffect, useRef, useState } from 'react';\nimport useLatest from '../useLatest';\nimport useMemoizedFn from '../useMemoizedFn';\nimport useUnmount from '../useUnmount';\nexport var ReadyState;\n(function (ReadyState) {\n  ReadyState[ReadyState[\"Connecting\"] = 0] = \"Connecting\";\n  ReadyState[ReadyState[\"Open\"] = 1] = \"Open\";\n  ReadyState[ReadyState[\"Closing\"] = 2] = \"Closing\";\n  ReadyState[ReadyState[\"Closed\"] = 3] = \"Closed\";\n})(ReadyState || (ReadyState = {}));\nexport default function useWebSocket(socketUrl, options = {}) {\n  const {\n    reconnectLimit = 3,\n    reconnectInterval = 3 * 1000,\n    manual = false,\n    onOpen,\n    onClose,\n    onMessage,\n    onError,\n    protocols\n  } = options;\n  const onOpenRef = useLatest(onOpen);\n  const onCloseRef = useLatest(onClose);\n  const onMessageRef = useLatest(onMessage);\n  const onErrorRef = useLatest(onError);\n  const reconnectTimesRef = useRef(0);\n  const reconnectTimerRef = useRef();\n  const websocketRef = useRef();\n  const unmountedRef = useRef(false);\n  const [latestMessage, setLatestMessage] = useState();\n  const [readyState, setReadyState] = useState(ReadyState.Closed);\n  const reconnect = () => {\n    var _a;\n    if (reconnectTimesRef.current < reconnectLimit && ((_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.readyState) !== ReadyState.Open) {\n      if (reconnectTimerRef.current) {\n        clearTimeout(reconnectTimerRef.current);\n      }\n      reconnectTimerRef.current = setTimeout(() => {\n        // eslint-disable-next-line @typescript-eslint/no-use-before-define\n        connectWs();\n        reconnectTimesRef.current++;\n      }, reconnectInterval);\n    }\n  };\n  const connectWs = () => {\n    if (reconnectTimerRef.current) {\n      clearTimeout(reconnectTimerRef.current);\n    }\n    if (websocketRef.current) {\n      websocketRef.current.close();\n    }\n    const ws = new WebSocket(socketUrl, protocols);\n    setReadyState(ReadyState.Connecting);\n    ws.onerror = event => {\n      var _a;\n      if (unmountedRef.current) {\n        return;\n      }\n      reconnect();\n      (_a = onErrorRef.current) === null || _a === void 0 ? void 0 : _a.call(onErrorRef, event, ws);\n      setReadyState(ws.readyState || ReadyState.Closed);\n    };\n    ws.onopen = event => {\n      var _a;\n      if (unmountedRef.current) {\n        return;\n      }\n      (_a = onOpenRef.current) === null || _a === void 0 ? void 0 : _a.call(onOpenRef, event, ws);\n      reconnectTimesRef.current = 0;\n      setReadyState(ws.readyState || ReadyState.Open);\n    };\n    ws.onmessage = message => {\n      var _a;\n      if (unmountedRef.current) {\n        return;\n      }\n      (_a = onMessageRef.current) === null || _a === void 0 ? void 0 : _a.call(onMessageRef, message, ws);\n      setLatestMessage(message);\n    };\n    ws.onclose = event => {\n      var _a;\n      if (unmountedRef.current) {\n        return;\n      }\n      reconnect();\n      (_a = onCloseRef.current) === null || _a === void 0 ? void 0 : _a.call(onCloseRef, event, ws);\n      setReadyState(ws.readyState || ReadyState.Closed);\n    };\n    websocketRef.current = ws;\n  };\n  const sendMessage = message => {\n    var _a;\n    if (readyState === ReadyState.Open) {\n      (_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.send(message);\n    } else {\n      throw new Error('WebSocket disconnected');\n    }\n  };\n  const connect = () => {\n    reconnectTimesRef.current = 0;\n    connectWs();\n  };\n  const disconnect = () => {\n    var _a;\n    if (reconnectTimerRef.current) {\n      clearTimeout(reconnectTimerRef.current);\n    }\n    reconnectTimesRef.current = reconnectLimit;\n    (_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.close();\n  };\n  useEffect(() => {\n    if (!manual) {\n      connect();\n    }\n  }, [socketUrl, manual]);\n  useUnmount(() => {\n    unmountedRef.current = true;\n    disconnect();\n  });\n  return {\n    latestMessage,\n    sendMessage: useMemoizedFn(sendMessage),\n    connect: useMemoizedFn(connect),\n    disconnect: useMemoizedFn(disconnect),\n    readyState,\n    webSocketIns: websocketRef.current\n  };\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}